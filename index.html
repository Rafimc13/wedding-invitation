<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
    apiKey: "AIzaSyD-rsYGh1BsZ-XcJT92CJcxE12Q9n-wNL0",
    authDomain: "wedding-rafkata.firebaseapp.com",
    projectId: "wedding-rafkata",
    storageBucket: "wedding-rafkata.firebasestorage.app",
    messagingSenderId: "404080911551",
    appId: "1:404080911551:web:ec21538bfd0fc090ad920a",
    measurementId: "G-35CKFVW71P"
    };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ραφαήλ & Κατερίνα</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(135deg, #fff8f0, #fce4ec);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow-y: auto;
      font-family: 'Georgia', serif;
    }
  .map-button {
    background-color: #8b5e3c;
    color: #fff;
    border: none;
    padding: 2px 10px;
    margin: 2px 4px;
    font-size: 1.0em;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);  /* softer shadow */
  }
    .map-buttons {
    display: flex;
    gap: 6px;
    margin-top: 10px;
    flex-wrap: wrap;
    justify-content: center;
    }
    #mapButtons {
    display: none;
    margin-top: 5px;
    gap: 3px;
    flex-wrap: wrap;
    justify-content: center;
    }
    #mapButtons.visible {
    display: flex;
    }
    #rsvpContainer {
    display: none;
    flex-direction: column;
    align-items: center;
    margin-top: 5px;
    text-align: center;
    }
    #rsvpContainer.visible {
    display: flex;
    }
    #rsvp h3 {
    margin: 8px 0 5px 0;
    padding: 0;
    font-size: 1.1em; /* Optional: smaller text */
    }
    .container {
      position: relative;
      width: 420px;
      height: 520px;
      perspective: 1000px;
      margin-bottom: 5px;
    }

    .envelope {
      position: absolute;
      width: 100%;
      height: 100%;
      background: url('folder-closed-logo_2.png') no-repeat center/contain;
      transform-origin: top center; /* Make it flap upwards */
      transition: transform 1.5s ease;
      z-index: 2;
      cursor: pointer;
      backface-visibility: hidden; /* Hide the back face */
    }

    .invitation {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 1.5s ease, transform 1.5s ease;
      z-index: 1;
    }

    .invitation img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .open .envelope {
      transform: rotateX(90deg); /* Flap upwards */
      pointer-events: none; /* disable clicking on envelope when open */
    }

    .open .invitation {
      opacity: 1;
      transform: translateY(0);
    }

    .button {
      background-color: #8b5e3c;
      color: #fff;
      border: none;
      padding: 4px 20px;
      margin: 1px 0;
      font-size: 1.2em;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .button:hover {
      background-color: #a86d4b;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <div class="container" id="envelopeContainer">
    <div class="envelope" onclick="openEnvelope()"></div>
    <div class="invitation">
      <img id="invitationImage" src="invitation.jpeg" alt="Wedding Invitation">
    </div>
  </div>
  <button class="button" id="toggleButton" onclick="openEnvelope()">Άνοιγμα</button>
  <div id="rsvpContainer">
    <div id="rsvp">
      <h3 style="font-family: 'Georgia', serif;">Θα παρευρεθείτε στο γάμο μας;</h3>
      <form id="rsvpForm">
        <label style="font-size: 1.1em;">
          <input type="radio" name="attendance" value="Yes" required> Ναι
        </label>
        <label style="margin-left: 25px; font-size: 1.1em;">
          <input type="radio" name="attendance" value="No" required> Όχι
        </label>
        <br><br>
        <div style="display: flex; gap: 10px; justify-content: center;">
          <input type="text" id="guestName" placeholder="Όνομα Οικογένειας" style="padding: 6px 8px; border-radius: 6px; font-size: 1.1em; width: 220px;"/>
          <input type="number" id="guestCount" placeholder="Αρ. Ατόμων" min="1" max="10" style="padding: 6px 8px; border-radius: 6px; font-size: 1.1em; width: 110px;" />
        </div>
        <br>
        <button class="button" type="submit">Υποβολή</button>
      </form>
      <p id="confirmationMessage" style="color: green; margin-top: 10px;"></p>
    </div>
  </div>
  <div class="map-buttons" id="mapButtons">
    <a href="https://maps.app.goo.gl/1wUK4TtvxRL28XBe8" target="_blank">
      <button class="map-button">📍 Εκκλησία</button>
    </a>
    <a href="https://maps.app.goo.gl/saRWr7VBe3gGs4317" target="_blank">
      <button class="map-button">📍 Κτήμα</button>
    </a>
  </div>

  <script>
    const container = document.getElementById('envelopeContainer');
    const toggleButton = document.getElementById('toggleButton');
    const invitationImage = document.getElementById('invitationImage');

function openEnvelope() {
  if (!container.classList.contains('open')) {
    container.classList.add('open');
    toggleButton.style.display = "none";
    document.getElementById("mapButtons").classList.add("visible");
    document.getElementById("rsvpContainer").classList.add("visible");

  setTimeout(() => {
    const rsvp = document.getElementById("rsvpContainer");

    if (rsvp && typeof rsvp.scrollIntoView === 'function') {
      rsvp.scrollIntoView({ behavior: "smooth", block: "start" });

      // Fine-tune the scroll height slightly above the RSVP
      setTimeout(() => {
        const scrollOffset = rsvp.offsetTop - 100;  // adjust here
        window.scrollTo({ top: scrollOffset, behavior: "smooth" });
      }, 300);
    }
  }, 100);
  }
}

    function downloadInvitation() {
      const imageUrl = invitationImage.src;

      // Detect if it's a mobile device
      const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

      if (isMobile) {
        // On mobile: open in new tab so user can long-press and save
        window.open(imageUrl, '_blank');
        alert("The invitation has opened in a new tab. Long press the image to save it.");
      } else {
        // On desktop: trigger download
        const link = document.createElement('a');
        link.href = imageUrl;
        link.download = 'Rafail-Katerina-Invitation.jpeg';
        document.body.appendChild(link); // Firefox fix
        link.click();
        document.body.removeChild(link);
      }
    }
  </script>
  <script>
const rsvpForm = document.getElementById('rsvpForm');
const confirmationMessage = document.getElementById('confirmationMessage');

rsvpForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const rawName = document.getElementById('guestName').value.trim() || "Anonymous";
  const name = rawName.toLowerCase();
  const guestCountValue = document.getElementById('guestCount').value.trim();
  const answer = rsvpForm.attendance.value;

  // Validation: name must not contain digits, guest count must be integer > 0
  const nameContainsDigits = /\d/.test(name);
  const guestCount = parseInt(guestCountValue, 10);
  const guestCountInvalid = isNaN(guestCount) || guestCount <= 0;

  if (nameContainsDigits || guestCountInvalid) {
    confirmationMessage.textContent = "❌ Λάθος καταχώρηση.";
    confirmationMessage.style.color = "red";
    return;
  }

try {
    const querySnapshot = await db.collection("rsvp")
    .where("name", "==", name)
    .where("attending", "==", answer)
    .get();

    let alreadySubmittedSame = false;

    querySnapshot.forEach((doc) => {
    const data = doc.data();
    if (data.guestCount === guestCount) {
    alreadySubmittedSame = true;
    }
    });

  if (alreadySubmittedSame) {
    confirmationMessage.textContent = "⚠️ Έχετε ήδη καταχωρίσει αυτή την απάντηση.";
    confirmationMessage.style.color = "orange";
    return;
  }

    // Save response
    await db.collection("rsvp").add({
      name: name,
      attending: answer,
      guestCount: guestCount,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    confirmationMessage.textContent = "✅ Ευχαριστούμε πολύ!";
    confirmationMessage.style.color = "green";
    rsvpForm.reset();
  } catch (error) {
    confirmationMessage.textContent = "❌ Λάθος καταχώρηση.";
    confirmationMessage.style.color = "red";
    console.error("RSVP Error:", error);
  }
});
</script>
</body>
</html>